<header class="select-none">

  {# Accessibility Top Bar #}
  <div class="border-b-2 border-current/5">
    <div class="mx-auto max-w-7xl px-6 lg:px-8 py-2.5 flex justify-between items-center overflow-hidden">

      {# Latest Posts Carousel - Desktop Only #}
      {% set labels = ['üçä Fresh Squeeze:', 'üßÉ Just Juiced:', 'üçã Fresh Pick:'] %}
      {# Get 4 posts, filter out current page, take 3 #}
      {% set latestPosts = [] %}
      {% for post in collections.posts | reverse | head(4) %}
        {% if post.url !== page.url and latestPosts.length < 3 %}
          {% set latestPosts = (latestPosts.push(post), latestPosts) %}
        {% endif %}
      {% endfor %}
      <div class="hidden md:flex text-xs text-zinc-600 relative"
           x-data="{
             current: 0,
             total: {{ latestPosts.length }},
             init() {
               setInterval(() => { this.current = (this.current + 1) % this.total; }, 5000);
             }
           }">
        {% for post in latestPosts %}
        <a href="{{ post.url }}" x-cloak
           class="group inline-flex items-center gap-2 hover:text-zinc-900 whitespace-nowrap transition-all duration-300 ease-out {% if not loop.first %}absolute left-0 top-0{% endif %}"
           :class="current === {{ loop.index0 }} ? 'translate-y-0 opacity-100' : (current === {{ (loop.index0 - 1) if loop.index0 > 0 else 2 }} ? '-translate-y-full opacity-0' : 'translate-y-full opacity-0')">
          <span class="font-medium text-zinc-400">{{ labels[loop.index0] }}</span>
          <span class="truncate max-w-sm">{{ post.data.title }}</span>
          <span class="transition-all group-hover:translate-x-1">‚Üí</span>
        </a>
        {% endfor %}
      </div>

      {# Spacer for mobile #}
      <div class="lg:hidden"></div>

      <button
        type="button"
        role="switch"
        :aria-checked="highContrast"
        @click="toggleHighContrast()"
        class="a11y-contrast-toggle"
        title="Toggle high contrast mode"
      >
        <span class="a11y-contrast-toggle__switch" aria-hidden="true"></span>
        <span class="a11y-contrast-toggle__label">High Contrast</span>
      </button>
    </div>
  </div>

  {# Desktop Menu #}
  <nav class="mx-auto flex gap-x-4 max-w-7xl items-center justify-between py-6 px-6 lg:px-8" aria-label="Global">

    <div class="flex items-center gap-x-12">
      <a href="/" class="inline-flex items-center gap-x-3 hover:text-red-600 shrink-0 -mt-3 w-40 sm:w-48">
        {% include "partials/logo.njk" %}
        <span class="sr-only">FreshJuice a HubSpot Theme</span>
      </a>
      <div class="hidden lg:flex md:gap-x-12">
        {% for item in menu.main %}
          <a href="{{ item.url }}" class="text-sm font-semibold leading-6 hover:text-red-600 whitespace-nowrap">{{ item.title }}</a>
        {% endfor %}
      </div>
    </div>

    <div class="hidden lg:flex items-center">
      <a href="/contact/" class="btn btn--primary" title="Contact FreshJuice">Contact Us</a>
    </div>

    <div class="flex lg:hidden items-center gap-x-4 text-gray-600 leading-none">
      <button type="button" class="btn btn--secondary btn--xs sm:btn--sm" @click="openDrawer()">
        <span class="sr-only">Open main menu</span>
        MENU {% phicon "cherries", "bold", { class: "size-4 sm:size-6" } %}
      </button>
    </div>

  </nav>

  {# Mobile menu, show/hide based on menu open state. #}
  <div class="lg:hidden flex justify-end fixed top-0 inset-x-0 p-4 transition transform origin-top-right z-30"
       x-cloak
       x-show="drawerOpen"
       role="dialog"
       aria-modal="true"
       x-transition:enter="transition ease-out duration-200"
       x-transition:enter-start="opacity-0 translate-y-3 skew-x-6"
       x-transition:enter-end="opacity-100 translate-y-0 skew-x-0"
       x-transition:leave="transition ease-in duration-150"
       x-transition:leave-start="opacity-100 translate-y-0 skew-x-0"
       x-transition:leave-end="opacity-0 translate-y-3 skew-x-6">
    <div class="rounded-2xl bg-zinc-50 px-6 py-6 sm:max-w-sm sm:ring-1 sm:ring-gray-900/10 max-w-fit border-2 border-orange-300"
         @click.outside="closeDrawer()">
      <div class="absolute right-3 top-3 p-3 leaning-none">
        <button type="button" class="rounded-full p-2 hover:text-red-600" @click="closeDrawer()">
          <span class="sr-only">Close menu</span>
          {% phicon "x", "bold", { class: "size-6 m-0" } %}
        </button>
      </div>
      <div class="flow-root">
        <div class="min-w-40 px-6 sm:px-8">
          <div class="flex flex-col gap-2 pt-6 pb-2">
            {% for item in menu.main %}
              <a href="{{ item.url }}"
                 class="max-w-fit -mx-3 px-3 py-2 text-base font-semibold leading-7 hover:text-red-600">{{ item.title }}</a>
            {% endfor %}
          </div>
        </div>
      </div>
      <div class="w-full mt-4">
        <a href="/contact/" class="btn btn--primary w-full" title="Contact FreshJuice">Contact Us</a>
      </div>
    </div>
  </div>

</header>
